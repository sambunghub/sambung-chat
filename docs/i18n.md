# Internationalization (i18n) Guide

**Version:** 1.0
**Last Updated:** January 14, 2026
**License:** AGPL-3.0

---

## Overview

SambungChat uses `svelte-i18n` for internationalization (i18n), providing a simple yet flexible solution for multi-language support.

**Supported Languages:**

- ðŸ‡ºðŸ‡¸ English (en) - Default
- ðŸ‡®ðŸ‡© Indonesia (id) - Primary target

---

## Table of Contents

1. [Architecture](#architecture)
2. [Setup](#setup)
3. [Locale Files](#locale-files)
4. [Usage in Components](#usage-in-components)
5. [Language Persistence](#language-persistence)
6. [Adding New Languages](#adding-new-languages)
7. [Best Practices](#best-practices)

---

## Architecture

```
packages/ui/src/lib/i18n/
â”œâ”€â”€ index.ts              # i18n setup & configuration
â”œâ”€â”€ locales/
â”‚   â”œâ”€â”€ en.json           # English translations (default)
â”‚   â””â”€â”€ id.json           # Indonesia translations
â””â”€â”€ types.ts              # TypeScript definitions
```

**Why `svelte-i18n`?**

| Feature          | svelte-i18n                    | sveltekit-i18n         |
| ---------------- | ------------------------------ | ---------------------- |
| Simplicity       | âœ… Simple API                  | âš ï¸ More complex        |
| Flexibility      | âœ… App-based (no routing tied) | âŒ Route-based         |
| Svelte 5 Support | âœ… Full support                | âš ï¸ May need adaptation |
| Bundle Size      | âœ… Lightweight                 | âš ï¸ Larger              |
| TypeScript       | âœ… Type-safe                   | âœ… Type-safe           |

---

## Setup

### Installation

```bash
bun add svelte-i18n
```

### Configuration

**File:** `packages/ui/src/lib/i18n/index.ts`

```typescript
import { init, register, locale } from 'svelte-i18n';
import { get } from 'svelte/store';

// Register locales
register('en', () => import('./locales/en.json'));
register('id', () => import('./locales/id.json'));

// Initialize i18n
init({
  fallbackLocale: 'en',
  initialLocale: 'en',
});

// Helper to get current locale
export function getCurrentLocale(): string {
  return get(locale);
}

// Helper to set locale
export function setLocale(lang: 'en' | 'id') {
  locale.set(lang);
}

// Reactive locale store
export { locale };
```

### Database Schema

**File:** `packages/db/src/schema/user-settings.ts`

```typescript
import { pgTable, uuid, text } from 'drizzle-orm/pg-core';
import { user } from './user';

export const userSettings = pgTable('user_settings', {
  userId: uuid('user_id')
    .references(() => user.id)
    .primaryKey(),
  language: text('language').default('en').notNull(), // 'en' | 'id'
  theme: text('theme').default('light'),
  // ...
});
```

---

## Locale Files

### English (en.json)

**File:** `packages/ui/src/lib/i18n/locales/en.json`

```json
{
  "app": {
    "name": "SambungChat",
    "tagline": "Connect any AI model. Self-hosted. Privacy-first."
  },
  "common": {
    "save": "Save",
    "cancel": "Cancel",
    "delete": "Delete",
    "edit": "Edit",
    "close": "Close",
    "confirm": "Confirm",
    "search": "Search",
    "loading": "Loading...",
    "error": "An error occurred",
    "success": "Success"
  },
  "nav": {
    "chat": "Chat",
    "chats": "Chats",
    "folders": "Folders",
    "tags": "Tags",
    "models": "Models",
    "agents": "Agents",
    "plugins": "Plugins",
    "settings": "Settings"
  },
  "workspace": {
    "personal": "Personal",
    "team": "Team",
    "switchWorkspace": "Switch Workspace",
    "switchToPersonal": "Switch to Personal",
    "switchToTeam": "Switch to Team"
  },
  "team": {
    "createTeam": "Create Team",
    "inviteMembers": "Invite Members",
    "members": "Members",
    "settings": "Team Settings",
    "leave": "Leave Team",
    "role": {
      "admin": "Admin",
      "member": "Member"
    }
  },
  "chat": {
    "newChat": "New Chat",
    "send": "Send",
    "regenerate": "Regenerate",
    "copy": "Copy",
    "copied": "Copied!",
    "delete": "Delete",
    "share": "Share",
    "pin": "Pin",
    "unpin": "Unpin",
    "archive": "Archive",
    "title": "Chat Title",
    "empty": "Start a new conversation..."
  },
  "settings": {
    "title": "Settings",
    "appearance": "Appearance",
    "language": "Language",
    "theme": "Theme",
    "themeLight": "Light",
    "themeDark": "Dark",
    "themeSystem": "System",
    "fontSize": "Font Size",
    "sidebarWidth": "Sidebar Width",
    "privacy": "Privacy",
    "privacyMode": "Privacy Mode",
    "privacyModeDesc": "Disable telemetry and analytics"
  },
  "auth": {
    "signIn": "Sign In",
    "signUp": "Sign Up",
    "signOut": "Sign Out",
    "email": "Email",
    "password": "Password",
    "confirmPassword": "Confirm Password",
    "forgotPassword": "Forgot Password?",
    "rememberMe": "Remember me",
    "noAccount": "Don't have an account?",
    "hasAccount": "Already have an account?"
  },
  "models": {
    "selectModel": "Select Model",
    "provider": "Provider",
    "model": "Model",
    "apiKey": "API Key",
    "addKey": "Add API Key",
    "removeKey": "Remove API Key",
    "testConnection": "Test Connection"
  },
  "folder": {
    "create": "Create Folder",
    "rename": "Rename Folder",
    "delete": "Delete Folder",
    "name": "Folder Name"
  },
  "tag": {
    "create": "Create Tag",
    "rename": "Rename Tag",
    "delete": "Delete Tag",
    "name": "Tag Name",
    "color": "Color"
  }
}
```

### Indonesia (id.json)

**File:** `packages/ui/src/lib/i18n/locales/id.json`

```json
{
  "app": {
    "name": "SambungChat",
    "tagline": "Hubungkan model AI apa saja. Self-hosted. Privasi utama."
  },
  "common": {
    "save": "Simpan",
    "cancel": "Batal",
    "delete": "Hapus",
    "edit": "Edit",
    "close": "Tutup",
    "confirm": "Konfirmasi",
    "search": "Cari",
    "loading": "Memuat...",
    "error": "Terjadi kesalahan",
    "success": "Berhasil"
  },
  "nav": {
    "chat": "Chat",
    "chats": "Percakapan",
    "folders": "Folder",
    "tags": "Tag",
    "models": "Model",
    "agents": "Agen",
    "plugins": "Plugin",
    "settings": "Pengaturan"
  },
  "workspace": {
    "personal": "Pribadi",
    "team": "Tim",
    "switchWorkspace": "Ganti Workspace",
    "switchToPersonal": "Ganti ke Pribadi",
    "switchToTeam": "Ganti ke Tim"
  },
  "team": {
    "createTeam": "Buat Tim",
    "inviteMembers": "Undang Anggota",
    "members": "Anggota",
    "settings": "Pengaturan Tim",
    "leave": "Keluar Tim",
    "role": {
      "admin": "Admin",
      "member": "Anggota"
    }
  },
  "chat": {
    "newChat": "Chat Baru",
    "send": "Kirim",
    "regenerate": "Regenerasi",
    "copy": "Salin",
    "copied": "Disalin!",
    "delete": "Hapus",
    "share": "Bagikan",
    "pin": "Semat",
    "unpin": "Lepas Semat",
    "archive": "Arsip",
    "title": "Judul Chat",
    "empty": "Mulai percakapan baru..."
  },
  "settings": {
    "title": "Pengaturan",
    "appearance": "Tampilan",
    "language": "Bahasa",
    "theme": "Tema",
    "themeLight": "Terang",
    "themeDark": "Gelap",
    "themeSystem": "Sistem",
    "fontSize": "Ukuran Font",
    "sidebarWidth": "Lebar Sidebar",
    "privacy": "Privasi",
    "privacyMode": "Mode Privasi",
    "privacyModeDesc": "Nonaktifkan telemetry dan analitik"
  },
  "auth": {
    "signIn": "Masuk",
    "signUp": "Daftar",
    "signOut": "Keluar",
    "email": "Email",
    "password": "Kata Sandi",
    "confirmPassword": "Konfirmasi Kata Sandi",
    "forgotPassword": "Lupa Kata Sandi?",
    "rememberMe": "Ingat saya",
    "noAccount": "Belum punya akun?",
    "hasAccount": "Sudah punya akun?"
  },
  "models": {
    "selectModel": "Pilih Model",
    "provider": "Penyedia",
    "model": "Model",
    "apiKey": "API Key",
    "addKey": "Tambah API Key",
    "removeKey": "Hapus API Key",
    "testConnection": "Uji Koneksi"
  },
  "folder": {
    "create": "Buat Folder",
    "rename": "Ganti Nama Folder",
    "delete": "Hapus Folder",
    "name": "Nama Folder"
  },
  "tag": {
    "create": "Buat Tag",
    "rename": "Ganti Nama Tag",
    "delete": "Hapus Tag",
    "name": "Nama Tag",
    "color": "Warna"
  }
}
```

---

## Usage in Components

### Basic Usage (Svelte 5 Runes)

```svelte
<script lang="ts">
  import { _, locale } from '@sambung-chat/ui/i18n';
</script>

<h1>{$_.chat.newChat}</h1>
<button>{$_.common.save}</button>

<select bindvalue={$locale}>
  <option value="en">English</option>
  <option value="id">Indonesia</option>
</select>
```

### With Parameters

```svelte
<script lang="ts">
  import { _, locale } from '@sambung-chat/ui/i18n';

  let chatCount = 5;
</script>

<p>{$_('chat.count', { values: { count: chatCount } })}</p>

<!-- In locale files: -->
<!-- "chat.count": "You have {count} chats" -->
<!-- "chat.count": "Anda memiliki {count} percakapan" -->
```

### Language Switcher Component

**File:** `packages/ui/src/components/settings/LanguageSelector.svelte`

```svelte
<script lang="ts">
  import { locale } from '@sambung-chat/ui/i18n';
  import { settings } from '@sambung-chat/ui/stores';
  import { updateSettings } from '@sambung-chat/api';

  const languages = [
    { code: 'en', name: 'English', flag: 'ðŸ‡ºðŸ‡¸' },
    { code: 'id', name: 'Indonesia', flag: 'ðŸ‡®ðŸ‡©' },
  ];

  async function changeLanguage(langCode: string) {
    // Update locale immediately
    locale.set(langCode);

    // Save to database
    await updateSettings({ language: langCode });
  }
</script>

<select bindvalue={$locale} on:change={(e) => changeLanguage(e.target.value)}>
  {#each languages as lang}
    <option value={lang.code}>
      {lang.flag}
      {lang.name}
    </option>
  {/each}
</select>
```

### Pluralization

```svelte
<script lang="ts">
  import { _ } from '@sambung-chat/ui/i18n';
</script>

<p>{$_.message.nItems, { values: { count: items.length } }}</p>

<!-- In locale files: -->
/* en.json:
  "message": {
    "nItems": "No items | One item | {count} items"
  }
*/
/* id.json:
  "message": {
    "nItems": "Tidak ada item | Satu item | {count} item"
  }
*/
```

---

## Language Persistence

### Load on App Initialization

**File:** `apps/web/src/routes/+layout.ts`

```typescript
import { locale } from '@sambung-chat/ui/i18n';
import { page } from '$app/stores';

// Load user's language preference from session
export async function load({ data }) {
  if (data.user?.settings?.language) {
    locale.set(data.user.settings.language);
  }

  return {};
}
```

### Save to Database

**File:** `packages/api/src/routers/settings.ts`

```typescript
import { z } from 'zod';
import { router } from '@sambung-chat/orpc';
import { db } from '@sambung-chat/db';
import { userSettings } from '@sambung-chat/db/schema';
import { eq } from 'drizzle-orm';

export const settingsRouter = router({
  updateLanguage: {
    input: z.object({
      language: z.enum(['en', 'id']),
    }),
    resolve: async ({ input, context }) => {
      await db
        .update(userSettings)
        .set({ language: input.language })
        .where(eq(userSettings.userId, context.user.id));

      return { success: true };
    },
  },
});
```

---

## Adding New Languages

### Step 1: Create Locale File

```bash
# Create new locale file
touch packages/ui/src/lib/i18n/locales/zh.json
```

### Step 2: Add Translations

```json
{
  "app": {
    "name": "SambungChat",
    "tagline": "è¿žæŽ¥ä»»ä½• AI æ¨¡åž‹ã€‚è‡ªæ‰˜ç®¡ã€‚éšç§ä¼˜å…ˆã€‚"
  }
  // ... translate all keys
}
```

### Step 3: Register Locale

**File:** `packages/ui/src/lib/i18n/index.ts`

```typescript
import { init, register } from 'svelte-i18n';

register('en', () => import('./locales/en.json'));
register('id', () => import('./locales/id.json'));
register('zh', () => import('./locales/zh.json')); // Add this

init({
  fallbackLocale: 'en',
  initialLocale: 'en',
});
```

### Step 4: Update TypeScript Types

**File:** `packages/ui/src/lib/i18n/types.ts`

```typescript
export type Locale = 'en' | 'id' | 'zh'; // Add 'zh'
```

### Step 5: Add to Language Selector

Update the language selector options to include the new language.

---

## Best Practices

### 1. **Keep Keys Organized**

Use nested keys for better organization:

```json
âœ… Good:
{
  "chat": {
    "newChat": "New Chat",
    "send": "Send"
  }
}

âŒ Bad:
{
  "chat_newChat": "New Chat",
  "chat_send": "Send"
}
```

### 2. **Use Descriptive Keys**

```json
âœ… Good:
"chat.newChat"
"settings.appearance.theme"

âŒ Bad:
"chat.nc"
"set.ap.th"
```

### 3. **Provide Context in Comments**

```json
{
  "chat": {
    // Button label to start a new conversation
    "newChat": "New Chat",
    // Action to send message
    "send": "Send"
  }
}
```

### 4. **Handle Missing Translations**

```typescript
// Fallback to English if translation missing
const t = (key: string) => {
  return $t(key) || enTranslations[key] || key;
};
```

### 5. **Test with Both Languages**

Always test UI changes with both languages to ensure:

- No text overflow
- Proper spacing
- Correct grammar
- Cultural appropriateness

### 6. **Date/Number Formatting**

Use `Intl` APIs for locale-specific formatting:

```typescript
// Date formatting
const dateFormatter = new Intl.DateTimeFormat($locale, {
  dateStyle: 'long',
});

// Number formatting
const numberFormatter = new Intl.NumberFormat($locale, {
  style: 'currency',
  currency: 'IDR',
});
```

---

## Testing

### Unit Test Example

```typescript
import { describe, it, expect } from 'vitest';
import { init, locale } from 'svelte-i18n';
import en from '@sambung-chat/ui/i18n/locales/en.json';
import id from '@sambung-chat/ui/i18n/locales/id.json';

describe('i18n', () => {
  it('should have all required keys in English', () => {
    expect(en.app.name).toBe('SambungChat');
    expect(en.chat.newChat).toBeDefined();
  });

  it('should have all required keys in Indonesia', () => {
    expect(id.app.name).toBe('SambungChat');
    expect(id.chat.newChat).toBeDefined();
  });

  it('should have matching keys across locales', () => {
    const enKeys = Object.keys(en).sort();
    const idKeys = Object.keys(id).sort();
    expect(enKeys).toEqual(idKeys);
  });
});
```

---

## Related Documents

- **[Getting Started](./getting-started.md)** - Development setup
- **[Settings](./settings.md)** - Settings implementation
- **[Database Schema](../plan-reference/database.md)** - User settings schema
- **[svelte-i18n Documentation](https://svelte-i18n.vercel.app/)** - Official docs

---

## Troubleshooting

### Translation Not Loading

```typescript
// Ensure locale is registered
register('id', () => import('./locales/id.json'));

// Force locale reload
locale.set('id');
await tick(); // Svelte 5
```

### TypeScript Errors

```typescript
// Add type augmentation
declare module 'svelte-i18n' {
  interface Locales {
    en: typeof import('@sambung-chat/ui/i18n/locales/en.json');
    id: typeof import('@sambung-chat/ui/i18n/locales/id.json');
  }
}
```

### Missing Keys in Production

```typescript
// Add validation in build
const validateLocales = () => {
  const en = require('./locales/en.json');
  const id = require('./locales/id.json');

  const missingKeys = [];

  const checkKeys = (obj: any, prefix = '') => {
    for (const key in obj) {
      const fullKey = prefix ? `${prefix}.${key}` : key;
      if (typeof obj[key] === 'object') {
        checkKeys(obj[key], fullKey);
      } else if (!id[fullKey]) {
        missingKeys.push(fullKey);
      }
    }
  };

  checkKeys(en);

  if (missingKeys.length > 0) {
    console.warn('Missing translation keys:', missingKeys);
  }
};
```

---

**"Sambung: Connect any AI model. Self-hosted. Privacy-first. Open-source forever."**
