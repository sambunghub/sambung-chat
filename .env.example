# ════════════════════════════════════════════════════════════════════════════
# SambungChat Environment Configuration Example
# ════════════════════════════════════════════════════════════════════════════
#
# Copy this file to .env and fill in your actual values.
# DO NOT commit the .env file to version control.
#
# Required Steps:
# 1. Copy this file: cp .env.example .env
# 2. Fill in the required values below (marked with [REQUIRED])
# 3. Choose at least ONE AI provider and configure its API key
#
# Usage:
# - Local development: bun run dev
# - Docker development: docker-compose -f docker-compose.dev.yml up (or bun run docker:dev)
# - Docker production: docker-compose -f docker-compose.prod.yml up (or bun run docker:prod)
#
# ════════════════════════════════════════════════════════════════════════════

# ════════════════════════════════════════════════════════════════════════════
# CORE APPLICATION SETTINGS
# ════════════════════════════════════════════════════════════════════════════

# Node environment (development, production, or test)
NODE_ENV=development

# Server port (for local development)
SERVER_PORT=3000

# Web port (for local development)
WEB_PORT=5174

# Public Server URL (used by Better Auth client on frontend)
# This should point to the frontend URL where the user is
PUBLIC_SERVER_URL=http://localhost:5174

# Public API URL (backend API URL - used for fetch calls from frontend)
#
# IMPORTANT: For local development, this should point to the Vite dev server (http://localhost:5174)
# NOT the backend server directly (http://localhost:3000). This ensures that:
# 1. Session cookies are properly forwarded through the Vite proxy
# 2. CORS issues are avoided (same-origin requests)
# 3. CSRF tokens work correctly
#
# The Vite proxy is configured in vite.config.ts to forward /rpc and /ai requests to the backend
PUBLIC_API_URL=http://localhost:5174

# ════════════════════════════════════════════════════════════════════════════
# DATABASE CONFIGURATION
# ════════════════════════════════════════════════════════════════════════════

# PostgreSQL database connection string [REQUIRED]
# Format: postgresql://user:password@host:port/database
#
# Local development (from host machine): use localhost
#   DATABASE_URL=postgresql://postgres:password@localhost:5432/sambungchat_dev
#
# Docker Compose: docker-compose overrides this to use 'postgres' service name
#   DATABASE_URL=postgresql://postgres:password@postgres:5432/sambungchat_dev
DATABASE_URL=postgresql://postgres:password@localhost:5432/sambungchat_dev

# PostgreSQL Configuration (used by docker-compose files)
# These are used by Docker containers for PostgreSQL setup
POSTGRES_USER=postgres
POSTGRES_PASSWORD=password
POSTGRES_DB=sambungchat_dev

# PostgreSQL port (only if running PostgreSQL separately from Docker)
# Default: 5432
# POSTGRES_PORT=5432

# ════════════════════════════════════════════════════════════════════════════
# AUTHENTICATION CONFIGURATION
# ════════════════════════════════════════════════════════════════════════════

# Better-Auth secret key [REQUIRED]
# Must be at least 32 characters long
# Generate a secure secret: openssl rand -base64 32
BETTER_AUTH_SECRET=your-better-auth-secret-at-least-32-characters-long

# Better-Auth URL [REQUIRED]
# The URL where your backend server is running (for OAuth callbacks)
# OAuth flow: Keycloak -> Backend (3000) -> Frontend (5173)
# Local development: http://localhost:3000
# Docker dev: http://localhost:3000
# Production: https://your-domain.com
BETTER_AUTH_URL=http://localhost:3000

# SameSite cookie attribute [OPTIONAL]
# Controls when cookies are sent with cross-site requests to prevent CSRF attacks
#
# Options:
#   - strict: Cookies are ONLY sent with same-site requests (most secure)
#   - lax:     Cookies are sent with same-site requests and safe top-level navigations (default for development)
#   - none:    Cookies are sent with both same-site and cross-site requests (requires HTTPS)
#
# Security Recommendations:
#   - Production: Use 'strict' to prevent CSRF attacks from malicious links
#   - Development: Use 'lax' to allow OAuth flows and local testing
#   - Third-party integrations: Use 'none' ONLY if you need cross-origin cookies (requires HTTPS)
#
# Examples:
#   SAME_SITE_COOKIE=strict          # Production - maximum security
#   SAME_SITE_COOKIE=lax             # Development - OAuth-friendly
#   SAME_SITE_COOKIE=none            # Cross-origin scenarios (HTTPS only)
#
# Default: 'strict' for production, 'lax' for development
# SAME_SITE_COOKIE=strict

# Email/password authentication flag (shared between frontend and backend)
# Set to "false" to disable email/password login (e.g., when using SSO only)
EMAIL_PASSWORD_ENABLED=true
PUBLIC_EMAIL_PASSWORD_ENABLED=true

# ════════════════════════════════════════════════════════════════════════════
# CORS CONFIGURATION
# ════════════════════════════════════════════════════════════════════════════
#
# Cross-Origin Resource Sharing (CORS) controls which origins can access your API.
# Misconfiguring CORS can lead to security vulnerabilities including data theft,
# CSRF attacks, and unauthorized access.
#
# ⚠️  CRITICAL SECURITY WARNINGS ⚠️:
#   - NEVER use wildcard (*) in production - allows ANY website to access your API
#   - NEVER list origins you don't own or trust
#   - NEVER use HTTP in production - allows man-in-the-middle attacks
#   - NEVER include localhost in production configurations
#   - ALWAYS use HTTPS in production
#   - Keep the origin list as short as possible
#
# ─────────────────────────────────────────────────────────────────────────────
# Understanding CORS Origins
# ─────────────────────────────────────────────────────────────────────────────
#
# An "origin" consists of: protocol + domain + port
#   Example: https://example.com:3000
#
# Common mistakes:
#   ❌ http://localhost:3000     ← HTTP (insecure, use HTTPS)
#   ❌ https://example.com/      ← Trailing slash (will be auto-removed)
#   ❌ https://user:pass@example.com ← Embedded credentials (rejected)
#   ❌ *                        ← Wildcard (EXTREMELY DANGEROUS)
#   ✅ https://example.com      ← Correct (HTTPS, no trailing slash)
#   ✅ https://app.example.com  ← Correct (subdomain is different origin)
#
# ─────────────────────────────────────────────────────────────────────────────
# Single Origin Configuration (Recommended for Most Cases)
# ─────────────────────────────────────────────────────────────────────────────
#
# Development:
#   CORS_ORIGIN=http://localhost:5174
#
# Production (single domain):
#   CORS_ORIGIN=https://your-app.example.com
#
# ─────────────────────────────────────────────────────────────────────────────
# Multiple Origins Configuration
# ─────────────────────────────────────────────────────────────────────────────
#
# Use comma-separated values for multiple frontend origins:
#
#   CORS_ORIGIN=https://app.example.com,https://admin.example.com
#
# Note: Each origin is validated and sanitized on server startup.
#       - Trailing slashes are removed
#       - Whitespace is trimmed
#       - Malformed URLs cause startup failure
#
# ─────────────────────────────────────────────────────────────────────────────
# Environment-Specific Best Practices
# ─────────────────────────────────────────────────────────────────────────────
#
# Development:
#   - Use http://localhost:PORT for local testing
#   - HTTP is acceptable for local development only
#   - Keep port numbers consistent with your dev setup
#
# Production:
#   - ALWAYS use HTTPS origins
#   - Never include localhost
#   - Use exact domain matches (no wildcards)
#   - List only origins you control
#   - Consider using a reverse proxy for unified origin
#
# Staging/Testing:
#   - Use dedicated subdomains (e.g., https://staging.example.com)
#   - Keep staging origins separate from production
#   - Rotate staging origins when not in use
#
# ─────────────────────────────────────────────────────────────────────────────
# Security Risks of Misconfiguration
# ─────────────────────────────────────────────────────────────────────────────
#
# Wildcard (*) Risks:
#   - Any malicious website can make API requests to your backend
#   - Authentication cookies can be stolen
#   - User data can be exfiltrated
#   - CSRF attacks become trivial
#
# Overly Permissive Origins:
#   - Including untrusted domains expands your attack surface
#   - Typos in origin list can accidentally allow unauthorized access
#   - HTTP origins in production enable credential interception
#
# Example Attack Scenario:
#   If CORS_ORIGIN=* and a user visits evil.com:
#   1. evil.com makes fetch() request to https://your-api.com/users
#   2. Browser includes user's authentication cookies
#   3. Your API returns user data to evil.com
#   4. Attacker steals sensitive information
#
# ─────────────────────────────────────────────────────────────────────────────
# Troubleshooting
# ─────────────────────────────────────────────────────────────────────────────
#
# CORS errors in browser console?
#   - Verify origin matches exactly (protocol + domain + port)
#   - Check for typos in comma-separated list
#   - Ensure HTTPS is used in production
#   - Verify no trailing slashes in origin URLs
#
# Server won't start with CORS errors?
#   - Check for malformed URLs in CORS_ORIGIN
#   - Remove embedded credentials (user:pass@host)
#   - Ensure only http:// or https:// protocols are used
#   - Verify no wildcard (*) in production (warnings shown)
#
# ════════════════════════════════════════════════════════════════════════════

# CORS origin [REQUIRED]
# The frontend URL(s) that are allowed to make API requests
#
# Examples:
#   CORS_ORIGIN=http://localhost:5174                                    # Single origin (dev)
#   CORS_ORIGIN=https://your-app.example.com                             # Single origin (prod)
#   CORS_ORIGIN=https://app.example.com,https://admin.example.com        # Multiple origins
#
# See documentation above for security best practices
CORS_ORIGIN=http://localhost:5174

# ════════════════════════════════════════════════════════════════════════════
# KEYCLOAK OIDC CONFIGURATION (OPTIONAL)
# ════════════════════════════════════════════════════════════════════════════

# Enable Keycloak SSO on the frontend (shows "Sign in with SSO" button)
# Set to "true" when Keycloak is configured on the server
PUBLIC_KEYCLOAK_ENABLED=false

# Keycloak base URL
# Format: https://your-keycloak-domain
# Example: https://keycloak.example.com
# KEYCLOAK_URL=https://keycloak.example.com

# Keycloak realm name
# Example: myrealm
# KEYCLOAK_REALM=myrealm

# Keycloak client ID for OIDC authentication
# Create a client in your Keycloak realm to get this value
# KEYCLOAK_CLIENT_ID=your-keycloak-client-id

# Keycloak client secret for OIDC authentication
# Create a confidential client in Keycloak to get this value
# KEYCLOAK_CLIENT_SECRET=your-keycloak-client-secret

# Keycloak issuer URL (optional, will be constructed from KEYCLOAK_URL and KEYCLOAK_REALM if not provided)
# Format: https://your-keycloak-domain/realms/your-realm
# Example: https://keycloak.example.com/realms/myrealm
# KEYCLOAK_ISSUER=https://keycloak.example.com/realms/myrealm

# Note: At minimum, KEYCLOAK_URL, KEYCLOAK_REALM, KEYCLOAK_CLIENT_ID, and KEYCLOAK_CLIENT_SECRET must be set

# ════════════════════════════════════════════════════════════════════════════
# SECURITY HEADERS CONFIGURATION (OPTIONAL)
# ════════════════════════════════════════════════════════════════════════════
#
# These environment variables control security headers to prevent XSS, clickjacking,
# and other security vulnerabilities. All variables are OPTIONAL and have sensible
# defaults based on the environment (development/production).
#
# Quick Reference:
# - Development: Security headers are relaxed for debugging
# - Production: Strict security headers are enabled by default
# - You can override any header by setting the corresponding environment variable
#
# ════════════════════════════════════════════════════════════════════════════

# Enable/disable security headers globally
# Set to "false" to disable all security headers (useful for development/debugging)
# Default: "true" in production, "false" in development
# SECURITY_HEADERS_ENABLED=true

# Content Security Policy (CSP) - Controls which resources can be loaded
# Prevents XSS by restricting sources of scripts, styles, images, etc.
#
# Format: Semicolon-separated directives
# Example: "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'"
#
# Default (if not set): Automatically configured based on environment
# - Development: Relaxed policy with 'unsafe-inline' and 'unsafe-eval'
# - Production: Strict policy allowing only same-origin resources
#
# Learn more: https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP
# CSP_HEADER=default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'

# CSP Report-Only Mode - Test CSP without enforcing
# Set to "true" to report violations without blocking them
# Useful for testing CSP policies before enforcing in production
# Default: "false"
# CSP_REPORT_ONLY=false

# HTTP Strict Transport Security (HSTS) - Enforces HTTPS connections
# Tells browsers to only use HTTPS for the specified duration
#
# Format: Number of seconds
# Recommended values:
#   - 31536000 (1 year) for production
#   - 0 (disable) for development
#
# Default: 31536000 in production, 0 in development
# HSTS_MAX_AGE=31536000

# HSTS includeSubDomains - Apply HSTS to all subdomains
# Set to "true" to apply HSTS to all subdomains
# Default: "true" in production, "false" in development
# HSTS_INCLUDE_SUBDOMAINS=true

# HSTS preload - Allow domain inclusion in browser preload lists
# Set to "true" to submit your domain to https://hstspreload.org/
# This makes browsers permanently use HTTPS for your domain
# Default: "false"
# HSTS_PRELOAD=false

# X-Frame-Options - Prevents clickjacking attacks
# Controls whether your page can be embedded in frames/iframes
#
# Options:
#   - "DENY": No framing allowed (most secure)
#   - "SAMEORIGIN": Only allow framing from same origin (default)
#   - "ALLOW-FROM uri": Allow framing from specific URI (deprecated)
#
# Default: "SAMEORIGIN"
# X_FRAME_OPTIONS=SAMEORIGIN

# X-Content-Type-Options - Prevents MIME type sniffing
# Disables browser MIME type sniffing to prevent attacks
#
# Set to "nosniff" to enable (recommended)
# Default: "nosniff"
# X_CONTENT_TYPE_OPTIONS=nosniff

# Referrer-Policy - Controls referrer information sent
# Controls how much referrer information is sent with requests
#
# Options:
#   - "no-referrer": No referrer information sent
#   - "no-referrer-when-downgrade": Full URL when same protocol, no referrer otherwise
#   - "strict-origin-when-cross-origin": Origin only when cross-origin (recommended, default)
#   - "same-origin": Same origin only
#
# Default: "strict-origin-when-cross-origin"
# REFERRER_POLICY=strict-origin-when-cross-origin

# Permissions-Policy - Controls browser features/APIs usage
# Restricts access to browser features like camera, microphone, geolocation, etc.
#
# Format: Comma-separated feature=origin directives
# Example: "geolocation=(), camera=(self), microphone=(), payment=()"
#   - "feature=()": Disabled for all origins
#   - "feature=(self)": Enabled for same origin only
#   - "feature=*": Enabled for all origins
#
# Default (if not set): Restrictive policy disabling sensitive features
# PERMISSIONS_POLICY=geolocation=(), camera=(), microphone=(), payment=()

# Cross-Origin-Opener-Policy (COOP) - Process isolation
# Isolates the current page from same-origin documents
#
# Options:
#   - "unsafe-none": No isolation (default in development)
#   - "same-origin": Same-origin isolation (recommended for production, enables advanced APIs)
#
# Default: "unsafe-none" in development, "same-origin" in production
# CROSS_ORIGIN_OPENER_POLICY=same-origin

# Cross-Origin-Resource-Policy (CORP) - Resource sharing control
# Controls how the resource can be shared across origins
#
# Options:
#   - "same-origin": Same origin only (default, recommended)
#   - "same-site": Same site only
#   - "cross-origin": Any origin (less secure)
#
# Default: "same-origin"
# CROSS_ORIGIN_RESOURCE_POLICY=same-origin

# ════════════════════════════════════════════════════════════════════════════
# AI PROVIDER SELECTION
# ════════════════════════════════════════════════════════════════════════════

# Primary AI provider selection
# Can be a single provider or comma-separated fallback chain
#
# Examples:
#   AI_PROVIDER=openai                    # Use OpenAI only
#   AI_PROVIDER=anthropic                  # Use Anthropic only
#   AI_PROVIDER=google                     # Use Google only
#   AI_PROVIDER=groq                       # Use Groq only
#   AI_PROVIDER=ollama                     # Use Ollama (local AI, no API key needed)
#   AI_PROVIDER=openai,anthropic,groq      # Fallback chain (try OpenAI, then Anthropic, then Groq)
#
# If not set, the provider will be auto-selected based on available API keys
AI_PROVIDER=openai

# Default AI model (used when provider-specific model is not set)
# Examples: "gpt-4o-mini", "claude-3-5-sonnet-20241022", "gemini-2.5-flash"
# AI_MODEL=gpt-4o-mini

# ════════════════════════════════════════════════════════════════════════════
# OPENAI CONFIGURATION (including OpenAI-compatible APIs)
# ════════════════════════════════════════════════════════════════════════════

# OpenAI API key (Required for OpenAI provider)
# Get your key from: https://platform.openai.com/api-keys
# Format: sk-...
OPENAI_API_KEY=your-openai-api-key-here

# OpenAI model selection (Optional)
# Defaults to gpt-4o-mini if not specified
# Options: gpt-4o-mini (fast/cheap), gpt-4o (balanced), o1-mini (reasoning), o1-preview (advanced)
# For Z.AI: glm-4.7
OPENAI_MODEL=gpt-4o-mini

# Custom OpenAI base URL (Optional)
# For OpenAI-compatible APIs like Z.AI
# Defaults to https://api.openai.com/v1
# Z.AI example: https://api.z.ai/api/coding/paas/v4
OPENAI_BASE_URL=https://api.openai.com/v1

# OpenAI organization ID (Optional)
# For org-level billing
# Find it at: https://platform.openai.com/account/org-settings
# OPENAI_ORGANIZATION=org-your-organization-id

# ════════════════════════════════════════════════════════════════════════════
# ANTHROPIC CONFIGURATION
# ════════════════════════════════════════════════════════════════════════════

# Anthropic API key (Required for Anthropic provider)
# Get your key from: https://console.anthropic.com/
# Format: sk-ant-...
# ANTHROPIC_API_KEY=sk-ant-your-anthropic-api-key-here

# Anthropic model selection (Optional)
# Defaults to claude-3-5-sonnet-20241022 if not specified
# Options: claude-3-5-sonnet-20241022 (balanced), claude-3-5-haiku-20241022 (fast/cheap), claude-3-opus-20240229 (most capable)
# ANTHROPIC_MODEL=claude-3-5-sonnet-20241022

# Custom Anthropic base URL (Optional)
# Defaults to https://api.anthropic.com
# ANTHROPIC_BASE_URL=https://api.anthropic.com

# Anthropic API version (Optional)
# Defaults to latest if not specified
# ANTHROPIC_VERSION=2023-06-01

# ════════════════════════════════════════════════════════════════════════════
# GOOGLE CONFIGURATION
# ════════════════════════════════════════════════════════════════════════════

# Google Generative AI API key (Required for Google provider)
# Get your key from: https://aistudio.google.com/app/apikey
# Format: AIza...
# GOOGLE_GENERATIVE_AI_API_KEY=your-google-api-key-here

# Alternative Google API key (Also accepted for backward compatibility)
# GOOGLE_API_KEY=your-google-api-key-here

# Google model selection (Optional)
# Defaults to gemini-2.5-flash if not specified
# Options: gemini-2.5-flash (fast/cheap), gemini-2.5-pro (more capable)
# GOOGLE_MODEL=gemini-2.5-flash

# ════════════════════════════════════════════════════════════════════════════
# GROQ CONFIGURATION
# ════════════════════════════════════════════════════════════════════════════

# Groq API key (Required for Groq provider)
# Get your key from: https://console.groq.com/keys
# Format: gsk_...
# GROQ_API_KEY=gsk-your-groq-api-key-here

# Groq model selection (Optional)
# Defaults to llama-3.3-70b-versatile if not specified
# Options: llama-3.3-70b-versatile (latest), llama-3.1-70b-versatile, mixtral-8x7b-32768
# GROQ_MODEL=llama-3.3-70b-versatile

# Custom Groq base URL (Optional)
# Defaults to https://api.groq.com/openai/v1
# GROQ_BASE_URL=https://api.groq.com/openai/v1

# ════════════════════════════════════════════════════════════════════════════
# OLLAMA CONFIGURATION (Local AI)
# ════════════════════════════════════════════════════════════════════════════

# Ollama runs locally, so no API key is required
# Make sure Ollama is running and the model is pulled
# Get Ollama from: https://ollama.com/
# Install models: ollama pull llama3.2

# Ollama model selection (Optional)
# Defaults to llama3.2 if not specified
# Options: llama3.2, llama3.1, mistral, codellama, gemma2, etc.
# OLLAMA_MODEL=llama3.2

# Ollama server URL (Optional)
# Defaults to http://localhost:11434/v1
# For Docker with host Ollama: http://host.docker.internal:11434
# OLLAMA_BASE_URL=http://localhost:11434/v1

# ════════════════════════════════════════════════════════════════════════════
# QUICK START EXAMPLES
# ════════════════════════════════════════════════════════════════════════════

# Example 1: Use Z.AI (OpenAI-compatible)
# AI_PROVIDER=openai
# OPENAI_API_KEY=your-z-ai-api-key
# OPENAI_BASE_URL=https://api.z.ai/api/coding/paas/v4
# OPENAI_MODEL=glm-4.7

# Example 2: Use OpenAI (Official)
# AI_PROVIDER=openai
# OPENAI_API_KEY=sk-...

# Example 3: Use Anthropic with Haiku (Fast & Cheap)
# AI_PROVIDER=anthropic
# ANTHROPIC_API_KEY=sk-ant-...
# ANTHROPIC_MODEL=claude-3-5-haiku-20241022

# Example 4: Fallback Chain for High Availability
# AI_PROVIDER=openai,anthropic,groq
# OPENAI_API_KEY=sk-...
# ANTHROPIC_API_KEY=sk-ant-...
# GROQ_API_KEY=gsk-...

# Example 5: Local AI (Zero Cost, Privacy-First)
# AI_PROVIDER=ollama
# OLLAMA_MODEL=llama3.2

# ════════════════════════════════════════════════════════════════════════════
# DOCKER DEVELOPMENT
# ════════════════════════════════════════════════════════════════════════════
#
# Quick Start with Docker:
#
# 1. Install dependencies locally (required for volume mounting):
#    bun install
#
# 2. Copy and configure environment:
#    cp .env.example .env
#    # Edit .env with your values
#
# 3. Start all services in Docker:
#    bun run docker:dev
#
# Services will be available at:
#   - Web App: http://localhost:5173
#   - API Server: http://localhost:3000
#   - PostgreSQL: localhost:5432
#
# Docker Commands:
#   bun run docker:dev          # Start all services
#   bun run docker:dev:build    # Rebuild and start
#   bun run docker:dev:logs     # View logs
#   bun run docker:dev:down     # Stop all services
#   bun run docker:prod         # Production mode
#
# ════════════════════════════════════════════════════════════════════════════
# SETUP INSTRUCTIONS
# ════════════════════════════════════════════════════════════════════════════

# 1. Copy this file to .env:
#    cp .env.example .env
#
# 2. Fill in the required values:
#    - DATABASE_URL: Your PostgreSQL connection string
#    - BETTER_AUTH_SECRET: Generate a secure secret (min 32 chars)
#    - BETTER_AUTH_URL: Your application URL
#    - CORS_ORIGIN: Your frontend URL
#
# 3. Configure at least ONE AI provider:
#    - For cloud providers: Get API key and set AI_PROVIDER
#    - For local AI: Install Ollama, pull a model, set AI_PROVIDER=ollama
#
# 4. Start the application:
#    - Local development: bun run dev
#    - Docker development: bun run docker:dev
#    - Docker production: bun run docker:prod
#
# ════════════════════════════════════════════════════════════════════════════
# SECURITY NOTES
# ════════════════════════════════════════════════════════════════════════════

# ⚠️  NEVER commit your .env file to version control
# ⚠️  NEVER share your API keys or secrets
# ⚠️  Use different API keys for development and production
# ⚠️  Rotate your API keys regularly
# ⚠️  Keep your BETTER_AUTH_SECRET secure and unpredictable
#
# ════════════════════════════════════════════════════════════════════════════
